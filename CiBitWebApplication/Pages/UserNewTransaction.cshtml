@page
@model CiBitWebApplication.Pages.UserNewTransactionModel
@{
    ViewData["Title"] = "AddTransaction";
    ViewData["User"] = "User";
    ViewData["Token"] = Model.Token;

}

@section scripts{
    <script src="~/lib/jquery/jquery2.min.js"></script>
    <script>
        var selected;
        var url;
        var settings;
        var list = "@Model.UserList?.UserNamesList";
        var id = "@Model.UserName";
        var amount;
        var research;
        var receiver;

        function Check() {
            amount =$("#Amount").val();
            research = $("#Research option:selected").val();
            receiver = $("#UserName option:selected").val();
            if (selected == 0) {
                if (amount > 0 && receiver !== null && receiver !== "")
                    $("#submit").attr("disabled", false);
                else
                    $("#submit").attr("disabled", true);
            }
            else if (selected == 1) {
                if (amount > 0 && id !== null && id !== "" && research !== null && research !== "")
                    $("#submit").attr("disabled", false);
                else
                    $("#submit").attr("disabled", true);

            }
            else
                $("#submit").attr("disabled", true);
        }

        function UpdateReciver() {
            selected = $("#type option:selected").val();
            $("#UserName").empty();

            if (selected == 0) {
                $("#UserName").append("<option value=''>Select Bank</option>");
                $.getJSON(`?handler=UserBank&Token=${"@Model.Token"}`, (data) => {
                    $.each(data, function (i, user) {
                        $("#UserName").append(`<option value="${user}">${user}</option>`)
                    });
                });
                $("#UserName option:eq(1)").attr('selected', true);
                $("#ResearchInfo").hide();
            }
            else {
                $("#UserName").append("<option value=''>Select User</option>");
                $.getJSON(`?handler=UsersList&Token=${"@Model.Token"}`, (data) => {
                    $.each(data, function (i, user) {
                        $("#UserName").append(`<option value="${user}">${user}</option>`)
                    });
                });
                $.getJSON(`?handler=List&Token=${"@Model.Token"}`, (data) => {
                    list = JSON.stringify(data);
                });
            }
            Check();
        }

        function UpdateResearch() {
            id = $("#UserName option:selected").val();
            $("#Research").empty();
            $("#Research").append("<option value=''>Select Research</option>");
            if (selected == 1) {
                $.getJSON(`?handler=ResearchList&Token=${"@Model.Token"}&id=${id}&List=${list}`, (data) => {
                    $.each(data, function (i, research) {
                        $("#Research").append(`<option value="${research}">${research}</option>`)
                    });
                });   
            }
            Check();
        }

    </script>
}
<style>
    .wrap-div {
        height: 460px;
    }

    .info-td {
        color: black;
    }

    .btn {
        color: black;
        width: 150px;
    }

    .error-td {
        color: red;
    }

    .wrap-title, .wrap-div .wrap-btn {
        display: flex;
        justify-content: center;
    }

    .wrap-form {
        margin: auto;
    }

    .wrap-div .wrap-btn {
        margin-right: 45px;
    }

    .input-group-text {
        margin: 10px 0px;
    }
    input, select, .input-group-text {
        color: black;
        margin: 8px 0px;
        width: 300px;
    }

</style>
<div class="wrap-div">
    <div class="wrap-title">
        <h1>Create a new transaction</h1>
    </div>
    <form asp-page-handler="ProcessRequest" method="post">
        <input type="hidden" asp-for="Token" value="@Model.Token" />
        <table class="wrap-form">
            <tr>
                <td>
                    <span>Transaction Type:</span>
                </td>
                <td>
                    <select id="type" onchange="UpdateReciver()" asp-for="TransactionType">
                        <option value="">Select Type</option>
                        <option value="0">New Withdral</option>
                        <option value="1">New Trasaction</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <span>Sent to:</span>
                </td>
                <td>
                    <select asp-for="UserName" onchange="UpdateResearch()" asp-items="Model.UserSelectList">
                        <option value="">Select User</option>
                    </select>
                </td>
            </tr>
            <tr id="ResearchInfo">
                <td>
                    <span>Research:</span>
                </td>
                <td>
                    <select asp-for="Research" onchange="Check()" asp-items="Model.ResearchSelectList">
                        <option value="">Select research</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <span>Amount:</span>
                </td>
                <td>
                    <input type="text"  onblur="Check()" asp-for="Amount" class="input-group-text">
                </td>
            </tr>
        </table>
        <div class="form-group">
        </div>
        <div class="d-flex center-block login_container wrap-btn">
            <button id="submit" type="submit" name="button" style="color:black" class="btn" disabled="disabled">Send</button>
        </div>
    </form>
</div>

